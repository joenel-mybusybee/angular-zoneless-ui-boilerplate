import{a as F}from"./chunk-C7PWTPIW.js";import{a as p}from"./chunk-UJGH4TKB.js";import{b as U}from"./chunk-IZ3LLJO2.js";import{a as L,e as E,f as d,i as x}from"./chunk-52TRBPRN.js";import{g as I,t as j,u as y}from"./chunk-ELZ3HLUI.js";import{C as h,R as A,Ra as w,Y as s,aa as o,ba as k,hc as C,j as T,n as m,pa as S,pb as H,q as f,qa as b}from"./chunk-DQHNRFYU.js";var v=class r{constructor(e,t){this.authService=e;this.router=t}canActivate(e,t){return this.authService.isLoggedIn().pipe(f(i=>i?!0:this.router.createUrlTree(["login"],{queryParams:{message:U.loginFirst,returnUrl:t.url}})))}static \u0275fac=function(t){return new(t||r)(o(p),o(d))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var u=class r{constructor(e,t){this.authService=e;this.router=t}canActivate(){return this.authService.isLoggedIn().pipe(f(e=>e?this.router.createUrlTree(["/main/dashboard"]):!0))}static \u0275fac=function(t){return new(t||r)(o(p),o(d))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var D=[{path:"",loadComponent:()=>import("./chunk-45I4KXDD.js").then(r=>r.HomeComponent)},{path:"login",canActivate:[u],loadComponent:()=>import("./chunk-ZU3XHTHE.js").then(r=>r.LoginComponent)},{path:"forgot-password",canActivate:[u],loadComponent:()=>import("./chunk-JMHSM6XI.js").then(r=>r.ForgotPasswordComponent)},{path:"main",canActivate:[v],loadComponent:()=>import("./chunk-44MDWS5R.js").then(r=>r.MainRootComponent),children:F}];var l=class r{constructor(e,t){this.authService=e;this.location=t}leewayInSeconds=60;decodeToken(){return this.authService.getTokenData()||null}logoutAndRedirectToLogin(){let e=this.location.path();this.authService.logout();let t=new URL("/login",window.location.origin);t.searchParams.set("message","Your session has expired. Please log in again."),t.searchParams.set("returnUrl",e),window.location.href=t.toString()}isTokenExpired(){let e=this.decodeToken();if(!e)return!0;let t=Math.floor(Date.now()/1e3);if(e.iat>t)return console.warn("Token has a future issue date, considering it invalid"),!0;let i=e.exp<=t+this.leewayInSeconds;return i&&console.warn("Token will expire soon, considering it invalid."),i}isExemptedRoute(e){return e.url.includes("auth/")||e.url.includes("/api/")||e.url.includes("refresh")}intercept(e,t){let i=this.authService.getToken();if(console.log(e.url),this.isExemptedRoute(e))return t.handle(e);if(i){if(this.isTokenExpired()){let c=this.authService.getRefreshToken();return c?this.authService.refreshToken(c).pipe(A(n=>{this.authService.setTokens(n.accessToken,n.refreshToken);let a=e.clone({setHeaders:{Authorization:`Bearer ${n.accessToken}`}});return t.handle(a)}),h(n=>(this.logoutAndRedirectToLogin(),m(()=>n)))):(this.logoutAndRedirectToLogin(),T)}e=e.clone({setHeaders:{Authorization:`Bearer ${i}`}})}return t.handle(e).pipe(h(c=>{if(c.status===401){let n=this.authService.getRefreshToken();return n?this.authService.refreshToken(n).pipe(A(a=>{this.authService.setTokens(a.accessToken,a.refreshToken);let P=e.clone({setHeaders:{Authorization:`Bearer ${a.accessToken}`}});return t.handle(P)}),h(a=>(this.logoutAndRedirectToLogin(),m(()=>a)))):(this.logoutAndRedirectToLogin(),T)}return m(()=>c)}))}static \u0275fac=function(t){return new(t||r)(o(p),o(I))};static \u0275prov=s({token:r,factory:r.\u0275fac})};var G=(r,e)=>{let t={handle:e};return k(l).intercept(r,t)},M={providers:[S(),C(),x(D),l,j(y([G]))]};var g=class r{title=b("Angular Zoneless UI Boilerplate");static \u0275fac=function(t){return new(t||r)};static \u0275cmp=w({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(t,i){t&1&&H(0,"router-outlet")},dependencies:[E],encapsulation:2})};L(g,M).catch(r=>console.error(r));

import{a as F}from"./chunk-QFOLOZZ5.js";import{a as c}from"./chunk-UJGH4TKB.js";import{b as U}from"./chunk-IZ3LLJO2.js";import{a as y,e as j,f as d,i as x}from"./chunk-52TRBPRN.js";import{g as I,t as E,u as L}from"./chunk-ELZ3HLUI.js";import{C as h,R as A,Ra as H,Y as p,aa as n,ba as k,hc as C,j as T,n as m,pa as b,pb as w,q as f,qa as S}from"./chunk-DQHNRFYU.js";var v=class t{constructor(e,r){this.authService=e;this.router=r}canActivate(e,r){return this.authService.isLoggedIn().pipe(f(o=>o?!0:this.router.createUrlTree(["login"],{queryParams:{message:U.loginFirst,returnUrl:r.url}})))}static \u0275fac=function(r){return new(r||t)(n(c),n(d))};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var u=class t{constructor(e,r){this.authService=e;this.router=r}canActivate(){return this.authService.isLoggedIn().pipe(f(e=>e?this.router.createUrlTree(["/main/dashboard"]):!0))}static \u0275fac=function(r){return new(r||t)(n(c),n(d))};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var P=[{path:"",loadComponent:()=>import("./chunk-45I4KXDD.js").then(t=>t.HomeComponent)},{path:"login",canActivate:[u],loadComponent:()=>import("./chunk-ZU3XHTHE.js").then(t=>t.LoginComponent)},{path:"forgot-password",canActivate:[u],loadComponent:()=>import("./chunk-JMHSM6XI.js").then(t=>t.ForgotPasswordComponent)},{path:"main",canActivate:[v],loadComponent:()=>import("./chunk-4PJDWTQR.js").then(t=>t.MainRootComponent),children:F}];var l=class t{constructor(e,r){this.authService=e;this.location=r}leewayInSeconds=60;decodeToken(){return this.authService.getTokenData()||null}logoutAndRedirectToLogin(){let e=this.location.path();this.authService.logout();let o=`${(document.getElementsByTagName("base")[0]?.getAttribute("href")||"/").replace(/\/$/,"")}/login`,i=new URL(o,window.location.origin);i.searchParams.set("message","Your session has expired. Please log in again."),i.searchParams.set("returnUrl",e),window.location.href=i.toString()}isTokenExpired(){let e=this.decodeToken();if(!e)return!0;let r=Math.floor(Date.now()/1e3);if(e.iat>r)return console.warn("Token has a future issue date, considering it invalid"),!0;let o=e.exp<=r+this.leewayInSeconds;return o&&console.warn("Token will expire soon, considering it invalid."),o}isExemptedRoute(e){return e.url.includes("auth/")||e.url.includes("/api/")||e.url.includes("refresh")}intercept(e,r){let o=this.authService.getToken();if(console.log(e.url),this.isExemptedRoute(e))return r.handle(e);if(o){if(this.isTokenExpired()){let i=this.authService.getRefreshToken();return i?this.authService.refreshToken(i).pipe(A(a=>{this.authService.setTokens(a.accessToken,a.refreshToken);let s=e.clone({setHeaders:{Authorization:`Bearer ${a.accessToken}`}});return r.handle(s)}),h(a=>(this.logoutAndRedirectToLogin(),m(()=>a)))):(this.logoutAndRedirectToLogin(),T)}e=e.clone({setHeaders:{Authorization:`Bearer ${o}`}})}return r.handle(e).pipe(h(i=>{if(i.status===401){let a=this.authService.getRefreshToken();return a?this.authService.refreshToken(a).pipe(A(s=>{this.authService.setTokens(s.accessToken,s.refreshToken);let M=e.clone({setHeaders:{Authorization:`Bearer ${s.accessToken}`}});return r.handle(M)}),h(s=>(this.logoutAndRedirectToLogin(),m(()=>s)))):(this.logoutAndRedirectToLogin(),T)}return m(()=>i)}))}static \u0275fac=function(r){return new(r||t)(n(c),n(I))};static \u0275prov=p({token:t,factory:t.\u0275fac})};var N=(t,e)=>{let r={handle:e};return k(l).intercept(t,r)},D={providers:[b(),C(),x(P),l,E(L([N]))]};var g=class t{title=S("Angular Zoneless UI Boilerplate");static \u0275fac=function(r){return new(r||t)};static \u0275cmp=H({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(r,o){r&1&&w(0,"router-outlet")},dependencies:[j],encapsulation:2})};y(g,D).catch(t=>console.error(t));
